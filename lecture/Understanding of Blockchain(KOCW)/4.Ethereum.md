# 1. 이더리움 소개

### 스마트 계약을 지원하는 오픈소스 기반의 블록체인 플랫폼

- 2013년 Vitalik Buterin에 의해 제안

### 이더리움의 비전

- 멈추지 않으면서 검열에 강하고, 지속가능한 탈중앙화된 전세계를 대상으로 한 컴퓨터의 생성

### 비트코인의 개념을 확장

- 비트코인 : 여러 개의 컴퓨터에서 거래 내역을 검증하고 중복 저장하는 시스템
- 이더리움 : 비트코인 + 전 세계의 컴퓨터를 대상으로 프로그램을 실행할 수 있는 시스템
    - 스마트 계약
    - 이더리움 가상 머신 (Ethereum Virtual Machine : EVM)

## 비트코인과 이더리움의 유사성

- 이더리움도 블록체인을 갖는다.
    - http://etherscan.io
- 이더리움은 공공 블록체인이다.
    - 누구나 참여할 수 있고, 트랜잭션을 실행할 수 있다.
- 이더리움도 Ether(ETH)란 암호 화폐를 발행한다.
    - 비트코인처럼 화폐의 소유권은 블록체인에 기록
    - 1 ETH = 10^18 wei = 10^9 Gwei = 10^6 szabo

## 비트코인과 이더리움의 차이점

- 이더리움의 블록 생성 시간이 짧다.
    - 비트코인 : 10분 ↔ 이더리움 : 12초
- 이더리움의 블록 크기가 작다.
    - 비트코인 : 블록의 평균 크기 = 1.6Mbyte (블록당 2,000개 내외의 트랜잭션이 저장)
    - 이더리움 : 대부분의 블록이 100KB 내외 (블록당 200개 내외의 트랜잭션이 저장)
- 이더리움은 블록체인에 스마트 계약 (smart contract)이라는 프로그램을 저장한다.
    - 비트코인에서는 화폐의 흐름에 관한 트랜잭션만 저장된다.
    - 이더리움에서는 일반적인 트랜잭션 외에 프로그램의 배포, 실행에 관한 트랜잭션도 저장된다.
        - 이더리움에 참여하는 컴퓨터는 EVM을 이용해 스마트 계약을 실행할 수 있다.
    - 이더리움의 블록 합의 방식 : 지분 증명(PoS) ↔ 비트코인 : 작업 증명(PoW)

# 2. 스마트 계약 (Smart Contract)

- 블록체인에 저장되며, 설정 기준을 만족하면 자동 실행되는 프로그램

- 스마트 계약을 이용한 자판기 구현의 예
    - 설정 기준 : 사용자가 구매 금액을 투입한 후, 상품의 버튼을 누른다.
    - 계약 실행 : 사용자에게 상품을 제공

- 블록체인에서 스마트 계약을 지원함으로써 얻을 수 있는 장점
    - 상대를 신뢰하지 않아도 거래에 문제가 발생하지 않는다.
    - 중개자가 없으므로 비용 절감 가능
    - 스마트 계약 프로그램이 모든 참여자에게 공개되므로 투명성 제고

- 스마트 계약을 작성할 때 사용하는 프로그래밍 언어 : Solidity, Serpent 등

# 3. 계정(account)과 트랜잭션

## 이더리움에서는 두 종류의 계정이 존재

### Externally owned accounts (EOA)

- 비트코인의 주소와 같이 개인 키에 의해 제어되는 계정
- 새로운 트랜잭션을 시작할 수 있다.

### Contract accounts (CA)

- 스마트 계약의 프로그램에 의해 제어되는 계정
- 스스로 새로운 트랜잭션을 시작할 수 없고, 다른 트랜잭션의 요청으로 트랜잭션을 실행할 수 있다.

## 각 계정마다 20byte의 주소가 할당되고, 아래의 상태 정보를 가짐

- nonce : 계정에서 실행한 트랜잭션의 수(EOA), 계정에서 생성한 스마트 계약의 수(CA)
- balance : 계정이 소유한 잔고
- storageRoot : 스마트 계약 프로그램의 데이터에 대한 정보 (CA에서만 사용)
- codeHash : 스마트 계약 프로그램의 해시값 (CA에서만 사용)

## 이더리움의 World State Trie

- 2024년 8월 현재 2억 7천 8백만 개의 이더리움 계정이 존재 (매일 9만개 이상의 계정이 신설)
- 질문 : 전체 계정의 상태를 어떻게 관리할까?
    - 블록체인과 상태정보를 저장하는 상태 데이터베이스(state database)를 분리해서 관리한다. 위변조를 막기 위해서 상태 데이터베이스의 해시값을 블록체인에 저장한다. 상태 데이터베이스는 트라이 형태, 보통 머클 패트리시아 트라이라고 하는 자료 구조로 구성된다. 특정 계정은 20바이트의 주소를 가지는데, 이. ㅜ소로 트라이를 쉽게 검색할 수 있는 알고리즘을 제공하고 있다.

## 트랜잭션

- 3가지 유형의 이더리움 트랜잭션이 존재

### EOA들 간의 화폐 이동

- 비트코인 트랜잭션과 유사 (전송인, 수신인, 금액 등의 정보를 포함)

### 이더리움 네트워크에 새로운 contract 배포

- 생성을 요청하는 계정과 스마트 계약 코드 등을 포함

### 배포된 contract의 함수 실행

- 요청인의 EOA 주소와 대상 계약의 CA 주소를 포함
- 함수 실행에 필요한 Ether를 포함

## 가스(Gas)

- 트랜잭션 처리를 위한 모든 연산에는 비용이 발생
- 가스
    - 요금을 계산하는 단위 (1가스 = 1gwei = 10^9 wei)
    - 트랜잭션 처리 비용 = 가스 사용량 * (base fee + priority fee)
- Base fee
    - 트랜잭션을 처리하기 위한 기본적인 비용의 개념 (burning - (사라진다.))
    - 블록의 크기를 기준으로 설정되며, 블록이 클수록 요금도 상승 (100gwei ~)
- Priority fee
    - 블록의 채굴자에게 지급하는 요금

# 4. 지분 증명 (Proof of Stake : PoS)

### “The Merge” upgrade (2022년 9월 15일)

- Mainnet과 Beacon chain을 통합
    - Mainnet (블록체인 저장 및 트랜잭션 실행을 담당) ← Execution layer
    - Beacon chain (Beacon block을 이용한 PoS 수행) ← Consensus layer

### Pos : 32 Ether를 deposit contract에 예치하면 validator가 된다

- 블록을 생성할 validator를 무작위로 선정
- 나머지 validator들은 생성된 블록을 인증하는 역할을 담당
- 적어도 128명의 validator가 인증해야만 블록체인에 등록
- 지분의 비율대로 권한이 부여 (2024년 8월 현재 : 33.9M ETH 예치, 1,060,318명, 연지급율 = 3.2%)
- Validator가 규칙을 따르지 않으면 불이익을 얻는다 (예치금 몰수)
- 장점 : 에너지 비용 절감 (PoW의 어려운 문제를 풀지 않아도 됨)

# 5. 이더리움 통계

---

- 이더리움은 스마트 계약을 지원하는 블록체인이다.
- 스마트 계약은 블록체인에 저장되며, 설정 기준을 만족하면 자동 실행되는 프로그램이다.
- 이더리움의 계정은 EOA와 CA로 나뉘며, 각 계정에 대한 상태 정보를 유지한다.
- 이더리움에서 트랜잭션 실행은 비용이 발생하며, 가스 단위로 비용을 계산한다.
- 이더리움의 블록 생성은 지분 증명 (PoS) 방식을 따른다.