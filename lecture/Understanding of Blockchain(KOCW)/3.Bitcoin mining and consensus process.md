# 1. 채굴(mining)이란?

### 채굴 (mining) = 블록체인 끝에 새로운 블록을 추가하는 연산

## Mining 의 두 가지 목적

### 트랜잭션의 등록 (검증된 트랜잭션에만 블록체인에 등록)

- 평균 10분마다 새로운 블록이 채굴되어 등록
- 채굴 방법 : 작업 증명 (Proof-of-Work : PoW)

### 새로운 블록을 채굴한 채굴자에게 인센티브 지급

- 2024년 현재 인센티브 금액 = 한 블록에 3.125 BTC씩 지급
- 비트코인 시스템에서 새로운 화폐가 공급되는 유일한 방법

# 2. 비트코인에서 새로운 화폐의 공급

### 2009년 비트코인을 시작한 시점의 인센티브 = 블록당 50 BTC

### 210,000개의 블록이 채굴된 후, 지급액을 반으로 감소

- 감소 주기 = 10분/블록 * 210,000 = 4년

### 지급액이 0이 될 때까지의 시간과 발행량

- 32번의 반감기 후 블록당 1 Satoshi로 축소 (1BTC = 10^8 Satoshi)
- 2140년: 블록수 = 6,930,000, 지급액 = 0 (2024년 8월 현재 블록 번호 = 856,864)

### 전체 발행량 = 210,000 * 50 * (1 + 1/2 + 1/4 + …) = 21,000,000 BTC

- 그 이후로는 추가적인 화폐 공급이 없음

# 3. 작업 증명 (Proof of Work : PoW)

## Mining 과정

- 채굴자는 새로운 후보 블록을 생성
- Nonce를 제외한 모든 값을 결정
- Nonce의 값을 변경하면서 다음 조건을 검사

- SHA256(SHA256(헤더)) < Dificulty Target

### Nonce를 발견했다는 것의 의미

- 채굴자가 수행한 작업의 증명 (즉, target보다 적은 결과 값을 찾기 위해 nonce를 바꾸어가면서 SHA256을 몇 번 수행했다는 증명)

## Difficulty Target의 의미

- SHA256의 실행 예

```jsx
I am Satoshi Nakamoto11 => 7045da6ed8a914690f087690e1e8d66
I am Satoshi Nakamoto12 => 60f01db30c1a0d4cbce2b4b22e88b9b
I am Satoshi Nakamoto13 => 0ebc56d59a34f5082aaef3d66b37a66
I am Satoshi Nakamoto14 => 27ead1ca85da66981fd9da01a8c6816
I am Satoshi Nakamoto15 => 394809fb809c5f83ce97ab554a2812c
I am Satoshi Nakamoto16 => 8fa4992219df33f508344f65d3047429
I am Satoshi Nakamoto17 => dca9b8b4f8d8e1521fa4eaa46f4f0cd
I am Satoshi Nakamoto18 => 9989a401b2a3a318b01e9ca9a22b0f3
I am Satoshi Nakamoto19 => cda56022ecb5b67b2bc93a2d764e75f
```

- 16진수 0으로 시작하는 문장의 nonce는 ?
    - 0x10000000 … 보다 작은 hash 값을 찾기
    - Target = 0x10000… (0으로 시작) ← 확률 : 1/16
- Target이 0x01000… (00으로 시작)일 경우의 확률은 ? ← 1/256
- Target = 0x0….01 (63개의 0으로 시작)일 경우의 확률은 ?  ← 1/16^63

## 블록의 예 (856,571번 블록)

블록 해시 = 00000000000000000001210cb3298d73eb62a09f3ba8b83dbf97f5cc7a3fe404

- 채굴 시기 = 2024년 8월 13일 17시 27분 37초
- 채굴자 = Foundry USA
- Difficulty Target = 0x17031abe → 031abe * 2^160
  • 16진수로 표현: (00| 18개) (031abe) (00| 40개)
- Nonce = 0xdf388f77
- 블록 채굴에 대한 보상 금액 = 3.125 BTC(인센티브) + 0.08642 BTC(수수료)

### 참고 : Difficulty Target의 설정

- 동일한 난이도 vs. Hardware 발전 속도
- 2,016개의 블록(2주)이 채굴될 때마다 난이도 재설정
- New Target = Old Target * (Actual Time of Last 2016 Blocks / 20160 minutes)

## 직접 채굴 게임에 참가해볼까?

### 내 PC의 성능

- Difficulty: 8388608 (23 bits)
- Starting search...
- Success with nonce 14214729
- Hash is 000001408cf12dbd20fcba6372a223e098d58786c6ff93488a9f74f5df4df0a3
- Elapsed Time: 24.1135 seconds
- Hashing Power: 589491 hashes per second

### 내가 PoW에서 이길 확률

610조 분의 1

# 4. 블록체인의 확장 과정

### 채굴자가 후보 블록의 nonce를 발견한 경우

- 블록에 nonce 값을 채운 후, 비트코인 네트워크의 이웃 참여자에게 전달
- 이웃 참여자는 블록의 유효성을 검사한 후, 자신의 이웃에게 다시 전파

### 이웃 참여자가 채굴자일 경우

- 예 : block height = 277,316이라고 가정
    - 자신이 채굴 중인 277,316 블록 작업을 중단
    - 277,316을 이전 블록으로 하는 자신의 후보 블록 (277,317)을 생성한 후, 채굴 시작

### 서로 다른 채굴자가 동시에 채굴에 성공하는 경우 ?

- 일시적으로 참여자의 블록체인 내용이 다를 수 있음 : Blockchain fork
- 각자의 상황에서 다음 블록을 위한 채굴을 진행하고, 길이가 긴 체인으로 수렴

---

- 비트코인에서 채굴은 트랜잭션의 등록과 새로운 화폐 제공의 목적을 갖는다.
- 비트코인에서는 채굴자에게 인센티브를 지급한다.
- 채굴자는 후보 블록을 생성한 후, 난이도 기준에 맞는 nonce 값을 찾기 위한 PoW를 수행한다.
- 새롭게 생성된 블록에 대해 모든 참여자가 유효성을 검사한다.